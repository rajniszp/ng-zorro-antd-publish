{"version":3,"names":["NzGraphEdgeType","nzTypeDefinition","item","NZ_GRAPH_LAYOUT_SETTING","graph","meta","nodeSep","rankSep","edgeSep","subScene","paddingTop","paddingBottom","paddingLeft","paddingRight","labelHeight","nodeSize","width","maxLabelWidth","height","node","labelOffset","bridge","radius","__decorate","decorators","target","key","desc","d","c","arguments","length","r","Object","getOwnPropertyDescriptor","Reflect","decorate","i","defineProperty","__metadata","metadataKey","metadataValue","metadata","create","__values","o","s","Symbol","iterator","m","call","next","value","done","TypeError","__read","n","e","ar","push","error","__spread","concat","SuppressedError","NzGraphData","source","this","_data","BehaviorSubject","expansionModel","SelectionModel","_a","clear","dataSource","prototype","toggle","nodeName","expand","compound","toBeSelected","findParents","_b","select","apply","collapse","toBeDeselected","findChildren","deselect","isExpanded","isSelected","collapseAll","expandAll","keys","setData","data","connect","_this","changes","changed","merge","pipe","map","disconnect","parents","parent","filter","find","includes","children","groupIds","child","reduce","pre","cur","Array","from","Set","Component","args","selector","template","NzGraphEdgeComponent","elementRef","ngZone","cdr","line","x","y","curve","curveLinear","el","nativeElement","edge","id","v","w","ngOnInit","initElementStyle","ngOnChanges","customTemplate","edgeType","onStable","take","subscribe","setLine","markForCheck","type","LINE","curveBasis","path","querySelector","setElementData","setPath","points","setAttribute","changeDetection","ChangeDetectionStrategy","OnPush","ElementRef","NgZone","ChangeDetectorRef","Input","Directive","exportAs","Minimap","svg","zoomG","mainZoom","minimap","maxWidth","labelPadding","minimapElement","minimapSvgElement","viewpointElement","canvas","canvasRect","getBoundingClientRect","handleEvent","event","minimapOffset","Number","attr","clickCoords","pointer","viewpointCoord","updateViewpoint","dragEvent","drag","subject","on","datum","defaultPrevented","viewpoint","minimapSvg","canvasBuffer","update","minimapSize","mainX","scaleMain","scaleMinimap","mainY","transform","zoomIdentity","translate","scale","sceneSize","getBBox","svgSelection","stylesText","_c","document","styleSheets","_d","k","cssRules","rules","_e","e_2","_f","cssText","replace","name","svgStyle","append","text","zoomGSelection","zoomTransform","Math","max","zoom","requestAnimationFrame","svgXml","XMLSerializer","serializeToString","remove","image","createElement","onload","context","getContext","clearRect","drawImage","style","src","encodeURIComponent","svgRect","viewpointSelection","viewpointWidth","viewpointHeight","mapWidth","mapHeight","min","classList","add","NzGraphMinimapComponent","init","containerEle","zoomBehavior","svgEle","zoomEle","host","NzGraphNodeComponent","builder","renderer2","nodeClick","EventEmitter","animationInfo","initialState","animationPlayer","triggerClick","preventDefault","emit","makeAnimation","animationFactory","getAnimationInfo","destroy","assign","build","query","group","animate","play","done$","Subject","onDone","complete","asObservable","makeNoAnimation","nodeTransform","computeCXPositionOfNodeShape","expanded","coreBox","AnimationBuilder","Renderer2","Output","InputBoolean","calculateTransform","targetEle","containerEleSize","targetEleSize","scaleUnit","Selection","bind","d3Transition","NzGraphZoomDirective","element","nzMinZoom","nzMaxZoom","nzTransformEvent","nzZoomChange","destroy$","ngAfterViewInit","ngOnDestroy","unbind","svgElement","gZoomElement","extent","scaleExtent","zoomed","nzZoom","reScale","interrupt","selectAll","fitCenter","duration","focus","getElementById","position","getRelativePositionInfo","svgTransform","centerX","topLeft","bottomRight","centerY","dx","left","dy","top","transition","translateBy","zTransform","nodeBox","nodeCtm","getScreenCTM","pointTL","createSVGPoint","pointBR","matrixTransform","isDataSource","NzGraphComponent","noAnimation","nzGraphZoom","nzRankDirection","nzAutoSize","nzGraphInitialized","nzGraphRendered","nzNodeClick","requestId","transformStyle","graphRenderedSubject$","ReplaySubject","renderInfo","mapOfNodeAttr","mapOfEdgeAttr","typedNodes","layoutSetting","nodeTrackByFun","_","edgeTrackByFun","subGraphTransform","coreTransform","parentNodeName","takeUntil","nzAutoFit","nzGraphData","nzGraphLayoutConfig","mergeConfig","currentValue","_switchDataSource","firstChange","drawGraph","rankDirection","selected","then","ngAfterContentChecked","_dataSubscription","observeRenderChanges","unsubscribe","cancelRequestAnimationFrame","clickNode","options","needResize","Promise","resolve","buildGraphInfo","drawNodes","nzNoAnimation","resizeNodeSize","makeNodesAnimation","listOfNodeComponent","listOfNodeElement","forEach","nodeEle","contentEle","clientRect","bBoxRect","nodes","dataStream","graphOptions","Error","detectChanges","parseInfo","buildGraph","dig","xOffset","yOffset","hasOwnProperty","edges","forkJoin","finalize","config","graphMeta","layout","subSceneMeta","defaultNodeMeta","defaultNode","defaultCompoundNodeMeta","defaultCompoundNode","encapsulation","ViewEncapsulation","None","NzNoAnimationDirective","Host","Optional","ViewChildren","read","ContentChild","NzGraphNodeDirective","static","TemplateRef","NzGraphGroupNodeDirective","NzGraphEdgeDirective","COMPONENTS","NzGraphDefsComponent","NgModule","declarations","imports","CommonModule","NzIconModule","NzSpinModule","NzNoAnimationModule","exports"],"sources":["../../components/graph/interface.ts","../../node_modules/tslib/tslib.es6.mjs","../../components/graph/data-source/graph-data-source.ts","../../components/graph/graph-defs.component.ts","../../components/graph/graph-edge.component.ts","../../components/graph/graph-edge.directive.ts","../../components/graph/graph-group-node.directive.ts","../../components/graph/core/minimap.ts","../../components/graph/graph-minimap.component.ts","../../components/graph/graph-node.component.ts","../../components/graph/graph-node.directive.ts","../../components/graph/core/utils.ts","../../components/graph/graph-zoom.directive.ts","../../components/graph/graph.component.ts","../../components/graph/graph.module.ts"],"sourcesContent":["/**\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://github.com/NG-ZORRO/ng-zorro-antd/blob/master/LICENSE\n */\n\nimport {\n  HierarchyBaseEdgeInfo,\n  HierarchyBaseNodeInfo,\n  HierarchyGraphDef,\n  HierarchyGraphEdgeDef,\n  HierarchyGraphNodeDef,\n  HierarchyGraphNodeInfo,\n  HierarchyGraphOption,\n  LayoutConfig\n} from 'dagre-compound';\nimport { NzSafeAny } from 'ng-zorro-antd/core/types';\n\nexport enum NzGraphEdgeType {\n  LINE = 'line',\n  CURVE = 'curve'\n}\n\nexport interface NzGraphDataDef extends HierarchyGraphDef {\n  nodes: NzGraphNodeDef[];\n  edges: NzGraphEdgeDef[];\n}\n\nexport interface NzGraphNodeDef extends HierarchyGraphNodeDef {\n  label?: string;\n}\n\nexport interface NzGraphEdgeDef extends HierarchyGraphEdgeDef {\n  label?: string;\n}\n\n// tslint:disable-next-line:no-empty-interface\nexport interface NzGraphOption extends HierarchyGraphOption {}\nexport declare type NzRankDirection = 'TB' | 'BT' | 'LR' | 'RL';\n\nexport interface NzGraphGroupNode extends HierarchyGraphNodeInfo {\n  nodes: Array<NzGraphNode | NzGraphGroupNode>;\n  edges: NzGraphEdge[];\n  [key: string]: NzSafeAny;\n}\n\nexport interface NzGraphNode extends HierarchyBaseNodeInfo {\n  id: NzSafeAny;\n  // TODO\n  name: NzSafeAny;\n  label?: string;\n  [key: string]: NzSafeAny;\n}\n\nexport interface NzGraphEdge extends HierarchyBaseEdgeInfo {\n  id: NzSafeAny;\n  v: NzSafeAny;\n  w: NzSafeAny;\n  label?: string;\n}\n\n// tslint:disable-next-line:no-empty-interface\nexport interface NzLayoutSetting extends LayoutConfig {}\n\nexport interface NzGraphBaseLayout {\n  layout: {\n    nodeSep: number;\n    rankSep: number;\n    edgeSep: number;\n  };\n  subScene: {\n    paddingTop: number;\n    paddingBottom: number;\n    paddingLeft: number;\n    paddingRight: number;\n    labelHeight: number;\n  };\n  defaultCompoundNode: {\n    width: number;\n    height: number;\n    maxLabelWidth: number;\n  };\n  defaultNode: {\n    width: number;\n    height: number;\n    labelOffset: number;\n    maxLabelWidth: number;\n  };\n  defaultEdge: {\n    type: NzGraphEdgeType | string; // Need to support extensions\n  };\n}\n\nexport function nzTypeDefinition<T>(): (item: unknown) => T {\n  return item => item as T;\n}\n\n// tslint:disable:no-shadowed-variable\nexport type NzDeepPartial<T> = {\n  [P in keyof T]?: T[P] extends Array<infer U>\n    ? Array<NzDeepPartial<U>>\n    : T[P] extends ReadonlyArray<infer U>\n    ? ReadonlyArray<NzDeepPartial<U>>\n    : NzDeepPartial<T[P]>;\n};\n\nexport type NzGraphLayoutConfig = NzDeepPartial<NzGraphBaseLayout>;\nexport const NZ_GRAPH_LAYOUT_SETTING: NzLayoutSetting = {\n  graph: {\n    meta: {\n      nodeSep: 50,\n      rankSep: 50,\n      edgeSep: 5\n    }\n  },\n  subScene: {\n    meta: {\n      paddingTop: 20,\n      paddingBottom: 20,\n      paddingLeft: 20,\n      paddingRight: 20,\n      labelHeight: 20\n    }\n  },\n  nodeSize: {\n    meta: {\n      width: 50,\n      maxLabelWidth: 0,\n      height: 50\n    },\n    node: {\n      width: 50,\n      height: 50,\n      labelOffset: 10,\n      maxLabelWidth: 40\n    },\n    bridge: {\n      width: 5,\n      height: 5,\n      radius: 2,\n      labelOffset: 0\n    }\n  }\n};\n\n// Zoom interface\n\nexport interface NzZoomTransform {\n  x: number;\n  y: number;\n  k: number;\n}\n\nexport interface RelativePositionInfo {\n  topLeft: { x: number; y: number };\n  bottomRight: { x: number; y: number };\n}\n","/******************************************************************************\nCopyright (c) Microsoft Corporation.\n\nPermission to use, copy, modify, and/or distribute this software for any\npurpose with or without fee is hereby granted.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\nPERFORMANCE OF THIS SOFTWARE.\n***************************************************************************** */\n/* global Reflect, Promise, SuppressedError, Symbol */\n\nvar extendStatics = function(d, b) {\n  extendStatics = Object.setPrototypeOf ||\n      ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n      function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n  return extendStatics(d, b);\n};\n\nexport function __extends(d, b) {\n  if (typeof b !== \"function\" && b !== null)\n      throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n  extendStatics(d, b);\n  function __() { this.constructor = d; }\n  d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n}\n\nexport var __assign = function() {\n  __assign = Object.assign || function __assign(t) {\n      for (var s, i = 1, n = arguments.length; i < n; i++) {\n          s = arguments[i];\n          for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n      return t;\n  }\n  return __assign.apply(this, arguments);\n}\n\nexport function __rest(s, e) {\n  var t = {};\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n      t[p] = s[p];\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n      for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n          if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n              t[p[i]] = s[p[i]];\n      }\n  return t;\n}\n\nexport function __decorate(decorators, target, key, desc) {\n  var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n  else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n}\n\nexport function __param(paramIndex, decorator) {\n  return function (target, key) { decorator(target, key, paramIndex); }\n}\n\nexport function __esDecorate(ctor, descriptorIn, decorators, contextIn, initializers, extraInitializers) {\n  function accept(f) { if (f !== void 0 && typeof f !== \"function\") throw new TypeError(\"Function expected\"); return f; }\n  var kind = contextIn.kind, key = kind === \"getter\" ? \"get\" : kind === \"setter\" ? \"set\" : \"value\";\n  var target = !descriptorIn && ctor ? contextIn[\"static\"] ? ctor : ctor.prototype : null;\n  var descriptor = descriptorIn || (target ? Object.getOwnPropertyDescriptor(target, contextIn.name) : {});\n  var _, done = false;\n  for (var i = decorators.length - 1; i >= 0; i--) {\n      var context = {};\n      for (var p in contextIn) context[p] = p === \"access\" ? {} : contextIn[p];\n      for (var p in contextIn.access) context.access[p] = contextIn.access[p];\n      context.addInitializer = function (f) { if (done) throw new TypeError(\"Cannot add initializers after decoration has completed\"); extraInitializers.push(accept(f || null)); };\n      var result = (0, decorators[i])(kind === \"accessor\" ? { get: descriptor.get, set: descriptor.set } : descriptor[key], context);\n      if (kind === \"accessor\") {\n          if (result === void 0) continue;\n          if (result === null || typeof result !== \"object\") throw new TypeError(\"Object expected\");\n          if (_ = accept(result.get)) descriptor.get = _;\n          if (_ = accept(result.set)) descriptor.set = _;\n          if (_ = accept(result.init)) initializers.unshift(_);\n      }\n      else if (_ = accept(result)) {\n          if (kind === \"field\") initializers.unshift(_);\n          else descriptor[key] = _;\n      }\n  }\n  if (target) Object.defineProperty(target, contextIn.name, descriptor);\n  done = true;\n};\n\nexport function __runInitializers(thisArg, initializers, value) {\n  var useValue = arguments.length > 2;\n  for (var i = 0; i < initializers.length; i++) {\n      value = useValue ? initializers[i].call(thisArg, value) : initializers[i].call(thisArg);\n  }\n  return useValue ? value : void 0;\n};\n\nexport function __propKey(x) {\n  return typeof x === \"symbol\" ? x : \"\".concat(x);\n};\n\nexport function __setFunctionName(f, name, prefix) {\n  if (typeof name === \"symbol\") name = name.description ? \"[\".concat(name.description, \"]\") : \"\";\n  return Object.defineProperty(f, \"name\", { configurable: true, value: prefix ? \"\".concat(prefix, \" \", name) : name });\n};\n\nexport function __metadata(metadataKey, metadataValue) {\n  if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\n}\n\nexport function __awaiter(thisArg, _arguments, P, generator) {\n  function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n  return new (P || (P = Promise))(function (resolve, reject) {\n      function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n      function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n      function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n      step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n}\n\nexport function __generator(thisArg, body) {\n  var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n  return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n  function verb(n) { return function (v) { return step([n, v]); }; }\n  function step(op) {\n      if (f) throw new TypeError(\"Generator is already executing.\");\n      while (g && (g = 0, op[0] && (_ = 0)), _) try {\n          if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n          if (y = 0, t) op = [op[0] & 2, t.value];\n          switch (op[0]) {\n              case 0: case 1: t = op; break;\n              case 4: _.label++; return { value: op[1], done: false };\n              case 5: _.label++; y = op[1]; op = [0]; continue;\n              case 7: op = _.ops.pop(); _.trys.pop(); continue;\n              default:\n                  if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                  if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                  if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                  if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                  if (t[2]) _.ops.pop();\n                  _.trys.pop(); continue;\n          }\n          op = body.call(thisArg, _);\n      } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n      if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n  }\n}\n\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  var desc = Object.getOwnPropertyDescriptor(m, k);\n  if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n  }\n  Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nexport function __exportStar(m, o) {\n  for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\n}\n\nexport function __values(o) {\n  var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\n  if (m) return m.call(o);\n  if (o && typeof o.length === \"number\") return {\n      next: function () {\n          if (o && i >= o.length) o = void 0;\n          return { value: o && o[i++], done: !o };\n      }\n  };\n  throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n}\n\nexport function __read(o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o), r, ar = [], e;\n  try {\n      while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  }\n  catch (error) { e = { error: error }; }\n  finally {\n      try {\n          if (r && !r.done && (m = i[\"return\"])) m.call(i);\n      }\n      finally { if (e) throw e.error; }\n  }\n  return ar;\n}\n\n/** @deprecated */\nexport function __spread() {\n  for (var ar = [], i = 0; i < arguments.length; i++)\n      ar = ar.concat(__read(arguments[i]));\n  return ar;\n}\n\n/** @deprecated */\nexport function __spreadArrays() {\n  for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n  for (var r = Array(s), k = 0, i = 0; i < il; i++)\n      for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n          r[k] = a[j];\n  return r;\n}\n\nexport function __spreadArray(to, from, pack) {\n  if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n      if (ar || !(i in from)) {\n          if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n          ar[i] = from[i];\n      }\n  }\n  return to.concat(ar || Array.prototype.slice.call(from));\n}\n\nexport function __await(v) {\n  return this instanceof __await ? (this.v = v, this) : new __await(v);\n}\n\nexport function __asyncGenerator(thisArg, _arguments, generator) {\n  if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\n  var g = generator.apply(thisArg, _arguments || []), i, q = [];\n  return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\n  function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\n  function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\n  function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\n  function fulfill(value) { resume(\"next\", value); }\n  function reject(value) { resume(\"throw\", value); }\n  function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\n}\n\nexport function __asyncDelegator(o) {\n  var i, p;\n  return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\n  function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: false } : f ? f(v) : v; } : f; }\n}\n\nexport function __asyncValues(o) {\n  if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\n  var m = o[Symbol.asyncIterator], i;\n  return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\n  function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\n  function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\n}\n\nexport function __makeTemplateObject(cooked, raw) {\n  if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\n  return cooked;\n};\n\nvar __setModuleDefault = Object.create ? (function(o, v) {\n  Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n  o[\"default\"] = v;\n};\n\nexport function __importStar(mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n  __setModuleDefault(result, mod);\n  return result;\n}\n\nexport function __importDefault(mod) {\n  return (mod && mod.__esModule) ? mod : { default: mod };\n}\n\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n  return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n}\n\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\n  if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\n  return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\n}\n\nexport function __classPrivateFieldIn(state, receiver) {\n  if (receiver === null || (typeof receiver !== \"object\" && typeof receiver !== \"function\")) throw new TypeError(\"Cannot use 'in' operator on non-object\");\n  return typeof state === \"function\" ? receiver === state : state.has(receiver);\n}\n\nexport function __addDisposableResource(env, value, async) {\n  if (value !== null && value !== void 0) {\n    if (typeof value !== \"object\" && typeof value !== \"function\") throw new TypeError(\"Object expected.\");\n    var dispose;\n    if (async) {\n        if (!Symbol.asyncDispose) throw new TypeError(\"Symbol.asyncDispose is not defined.\");\n        dispose = value[Symbol.asyncDispose];\n    }\n    if (dispose === void 0) {\n        if (!Symbol.dispose) throw new TypeError(\"Symbol.dispose is not defined.\");\n        dispose = value[Symbol.dispose];\n    }\n    if (typeof dispose !== \"function\") throw new TypeError(\"Object not disposable.\");\n    env.stack.push({ value: value, dispose: dispose, async: async });\n  }\n  else if (async) {\n    env.stack.push({ async: true });\n  }\n  return value;\n}\n\nvar _SuppressedError = typeof SuppressedError === \"function\" ? SuppressedError : function (error, suppressed, message) {\n  var e = new Error(message);\n  return e.name = \"SuppressedError\", e.error = error, e.suppressed = suppressed, e;\n};\n\nexport function __disposeResources(env) {\n  function fail(e) {\n    env.error = env.hasError ? new _SuppressedError(e, env.error, \"An error was suppressed during disposal.\") : e;\n    env.hasError = true;\n  }\n  function next() {\n    while (env.stack.length) {\n      var rec = env.stack.pop();\n      try {\n        var result = rec.dispose && rec.dispose.call(rec.value);\n        if (rec.async) return Promise.resolve(result).then(next, function(e) { fail(e); return next(); });\n      }\n      catch (e) {\n          fail(e);\n      }\n    }\n    if (env.hasError) throw env.error;\n  }\n  return next();\n}\n\nexport default {\n  __extends,\n  __assign,\n  __rest,\n  __decorate,\n  __param,\n  __metadata,\n  __awaiter,\n  __generator,\n  __createBinding,\n  __exportStar,\n  __values,\n  __read,\n  __spread,\n  __spreadArrays,\n  __spreadArray,\n  __await,\n  __asyncGenerator,\n  __asyncDelegator,\n  __asyncValues,\n  __makeTemplateObject,\n  __importStar,\n  __importDefault,\n  __classPrivateFieldGet,\n  __classPrivateFieldSet,\n  __classPrivateFieldIn,\n  __addDisposableResource,\n  __disposeResources,\n};\n","/**\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://github.com/NG-ZORRO/ng-zorro-antd/blob/master/LICENSE\n */\n\nimport { SelectionModel } from '@angular/cdk/collections';\nimport { NzSafeAny } from 'ng-zorro-antd/core/types';\nimport { BehaviorSubject, merge, Observable } from 'rxjs';\nimport { map } from 'rxjs/operators';\nimport { NzGraphDataDef } from '../interface';\nimport { NzGraphBaseSource } from './base-graph-source';\n\nexport class NzGraphData implements NzGraphBaseSource<NzGraphDataDef, string> {\n  private _data = new BehaviorSubject<NzGraphDataDef>({} as NzGraphDataDef);\n  dataSource!: NzGraphDataDef;\n  /** A selection model with multi-selection to track expansion status. */\n  expansionModel: SelectionModel<string> = new SelectionModel<string>(true);\n\n  /** Toggles one single data node's expanded/collapsed state. */\n  toggle(nodeName: string): void {\n    this.expansionModel.toggle(nodeName);\n  }\n\n  /** Expands one single data node. */\n  expand(nodeName: string): void {\n    const compound = this.dataSource.compound || {};\n    const toBeSelected = this.findParents(compound, nodeName, [nodeName]);\n    this.expansionModel.select(...toBeSelected);\n  }\n\n  /** Collapses one single data node. */\n  collapse(nodeName: string): void {\n    const compound = this.dataSource.compound || {};\n    const toBeDeselected = this.findChildren(compound, nodeName, [nodeName]);\n    this.expansionModel.deselect(...toBeDeselected);\n  }\n\n  /** Whether a given data node is expanded or not. Returns true if the data node is expanded. */\n  isExpanded(nodeName: string): boolean {\n    return this.expansionModel.isSelected(nodeName);\n  }\n\n  /** Collapse all dataNodes in the tree. */\n  collapseAll(): void {\n    this.expansionModel.clear();\n  }\n\n  expandAll(): void {\n    this.expansionModel.select(...Object.keys(this._data.value.compound || {}));\n  }\n\n  setData(data: NzGraphDataDef): void {\n    this.expansionModel?.clear();\n    this.dataSource = data;\n    this._data.next(data);\n  }\n\n  constructor(source?: NzGraphDataDef) {\n    if (source) {\n      this.expansionModel?.clear();\n      this.dataSource = source;\n      this._data.next(source);\n    }\n  }\n\n  connect(): Observable<NzGraphDataDef> {\n    const changes = [this._data, this.expansionModel.changed];\n    return merge(...changes).pipe(map(() => this._data.value));\n  }\n\n  disconnect(): void {\n    // do nothing for now\n  }\n\n  private findParents(data: NzSafeAny, key: string, parents: string[] = []): string[] {\n    const parent = Object.keys(data)\n      .filter(d => d !== key)\n      .find(d => data[d].includes(key));\n    if (!parent) {\n      return parents;\n    } else {\n      return this.findParents(data, parent, [parent, ...parents]);\n    }\n  }\n\n  private findChildren(data: NzSafeAny, key: string, children: string[] = []): string[] {\n    const groupIds = Object.keys(data);\n    const child = (data[key] || []).filter((c: string) => groupIds.includes(c));\n    if (child && child.length > 0) {\n      return child.reduce((pre: string[], cur: string) => {\n        return Array.from(new Set([...pre, ...this.findChildren(data, cur, [...children, cur])]));\n      }, children);\n    }\n    return children;\n  }\n}\n","/**\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://github.com/NG-ZORRO/ng-zorro-antd/blob/master/LICENSE\n */\n\nimport { Component } from '@angular/core';\n\n@Component({\n  selector: 'svg:defs[nz-graph-defs]',\n  template: `\n    <svg:marker\n      class=\"nz-graph-edge-marker\"\n      id=\"edge-end-arrow\"\n      viewBox=\"1 0 20 20\"\n      refX=\"8\"\n      refY=\"3.5\"\n      markerWidth=\"10\"\n      markerHeight=\"10\"\n      orient=\"auto\"\n    >\n      <svg:polygon points=\"0 0, 10 3.5, 0 7\"></svg:polygon>\n    </svg:marker>\n  `\n})\nexport class NzGraphDefsComponent {\n  constructor() {}\n}\n","/**\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://github.com/NG-ZORRO/ng-zorro-antd/blob/master/LICENSE\n */\n\nimport {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  ElementRef,\n  Input,\n  NgZone,\n  OnChanges,\n  OnInit,\n  SimpleChanges,\n  TemplateRef\n} from '@angular/core';\nimport { curveBasis, curveLinear, line } from 'd3-shape';\nimport { take } from 'rxjs/operators';\nimport { NzGraphEdge, NzGraphEdgeType } from './interface';\n\n@Component({\n  selector: '[nz-graph-edge]',\n  template: `\n    <ng-container *ngIf=\"customTemplate\" [ngTemplateOutlet]=\"customTemplate\" [ngTemplateOutletContext]=\"{ $implicit: edge }\"></ng-container>\n    <svg:g *ngIf=\"!customTemplate\">\n      <path class=\"nz-graph-edge-line\" [attr.marker-end]=\"'url(#edge-end-arrow)'\"></path>\n      <svg:text class=\"nz-graph-edge-text\" text-anchor=\"middle\" dy=\"10\" *ngIf=\"edge.label\">\n        <textPath [attr.href]=\"'#' + id\" startOffset=\"50%\">{{ edge.label }}</textPath>\n      </svg:text>\n    </svg:g>\n  `,\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class NzGraphEdgeComponent implements OnInit, OnChanges {\n  @Input() edge!: NzGraphEdge;\n  @Input() edgeType?: NzGraphEdgeType | string;\n\n  @Input() customTemplate?: TemplateRef<{\n    $implicit: NzGraphEdge;\n  }>;\n\n  public get id(): string {\n    return this.edge?.id || `${this.edge.v}--${this.edge.w}`;\n  }\n  private el!: SVGGElement;\n  private path!: SVGPathElement;\n\n  private line = line<{ x: number; y: number }>()\n    .x(d => d.x)\n    .y(d => d.y)\n    .curve(curveLinear);\n\n  constructor(private elementRef: ElementRef<SVGGElement>, private ngZone: NgZone, private cdr: ChangeDetectorRef) {\n    this.el = this.elementRef.nativeElement;\n  }\n\n  ngOnInit(): void {\n    this.initElementStyle();\n  }\n\n  ngOnChanges(changes: SimpleChanges): void {\n    const { edge, customTemplate, edgeType } = changes;\n    if (edge) {\n      this.ngZone.onStable.pipe(take(1)).subscribe(() => {\n        // Update path element if customTemplate set\n        if (customTemplate) {\n          this.initElementStyle();\n        }\n\n        this.setLine();\n        this.cdr.markForCheck();\n      });\n    }\n    if (edgeType) {\n      const type = this.edgeType === NzGraphEdgeType.LINE ? curveLinear : curveBasis;\n      this.line = line<{ x: number; y: number }>()\n        .x(d => d.x)\n        .y(d => d.y)\n        .curve(type);\n    }\n  }\n\n  initElementStyle(): void {\n    this.path = this.el.querySelector('path')!;\n    this.setElementData();\n  }\n\n  setLine(): void {\n    this.setPath(this.line(this.edge.points)!);\n  }\n\n  setPath(d: string): void {\n    this.path.setAttribute('d', d);\n  }\n\n  setElementData(): void {\n    if (!this.path) {\n      return;\n    }\n    this.path.setAttribute('id', this.id);\n    this.path.setAttribute('data-edge', this.id);\n    this.path.setAttribute('data-v', `${this.edge.v}`);\n    this.path.setAttribute('data-w', `${this.edge.w}`);\n  }\n}\n","/**\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://github.com/NG-ZORRO/ng-zorro-antd/blob/master/LICENSE\n */\n\nimport { Directive } from '@angular/core';\n\n@Directive({\n  selector: '[nzGraphEdge]',\n  exportAs: 'nzGraphEdge'\n})\nexport class NzGraphEdgeDirective {}\n","/**\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://github.com/NG-ZORRO/ng-zorro-antd/blob/master/LICENSE\n */\n\nimport { Directive } from '@angular/core';\n\n@Directive({\n  selector: '[nzGraphGroupNode]',\n  exportAs: 'nzGraphGroupNode'\n})\nexport class NzGraphGroupNodeDirective {}\n","/**\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://github.com/NG-ZORRO/ng-zorro-antd/blob/master/LICENSE\n */\n\nimport { drag } from 'd3-drag';\nimport { pointer, select } from 'd3-selection';\nimport { ZoomBehavior, zoomIdentity, ZoomTransform } from 'd3-zoom';\nimport { NzSafeAny } from 'ng-zorro-antd/core/types';\nimport { NzZoomTransform } from '../interface';\n\nconst FRAC_VIEWPOINT_AREA = 0.8;\n\nexport class Minimap {\n  private minimap: HTMLElement;\n  private canvas: HTMLCanvasElement;\n  private canvasRect: ClientRect;\n  private canvasBuffer: HTMLCanvasElement;\n  private minimapSvg: SVGSVGElement;\n  private viewpoint: SVGRectElement;\n  private scaleMinimap!: number;\n  private scaleMain!: number;\n  private maxWidth: number;\n  private translate!: [number, number];\n  private viewpointCoord: { x: number; y: number };\n  private minimapSize!: { width: number; height: number };\n  private labelPadding: number;\n\n  private svg: SVGSVGElement;\n  private zoomG: SVGGElement;\n  private mainZoom: ZoomBehavior<NzSafeAny, NzSafeAny>;\n\n  constructor(\n    svg: SVGSVGElement,\n    zoomG: SVGGElement,\n    mainZoom: ZoomBehavior<NzSafeAny, NzSafeAny>,\n    minimap: HTMLElement,\n    maxWidth: number,\n    labelPadding: number\n  ) {\n    this.svg = svg;\n    this.labelPadding = labelPadding;\n    this.zoomG = zoomG;\n    this.mainZoom = mainZoom;\n    this.maxWidth = maxWidth;\n    const minimapElement = select(minimap);\n    const minimapSvgElement = minimapElement.select('svg');\n    const viewpointElement = minimapSvgElement.select('rect');\n    this.canvas = minimapElement.select('canvas.viewport').node() as HTMLCanvasElement;\n    this.canvasRect = this.canvas.getBoundingClientRect();\n\n    const handleEvent = (event: NzSafeAny): void => {\n      const minimapOffset = this.minimapOffset();\n      const width = Number(viewpointElement.attr('width'));\n      const height = Number(viewpointElement.attr('height'));\n      const clickCoords = pointer(event, minimapSvgElement.node() as NzSafeAny);\n      this.viewpointCoord.x = clickCoords[0] - width / 2 - minimapOffset.x;\n      this.viewpointCoord.y = clickCoords[1] - height / 2 - minimapOffset.y;\n      this.updateViewpoint();\n    };\n    this.viewpointCoord = { x: 0, y: 0 };\n    const dragEvent = drag().subject(Object).on('drag', handleEvent);\n    viewpointElement.datum(this.viewpointCoord as NzSafeAny).call(dragEvent as NzSafeAny);\n\n    // Make the minimap clickable.\n    minimapSvgElement.on('click', event => {\n      if ((event as Event).defaultPrevented) {\n        // This click was part of a drag event, so suppress it.\n        return;\n      }\n      handleEvent(event);\n    });\n    this.viewpoint = viewpointElement.node() as SVGRectElement;\n    this.minimapSvg = minimapSvgElement.node() as SVGSVGElement;\n    this.minimap = minimap;\n    this.canvasBuffer = minimapElement.select('canvas.buffer').node() as HTMLCanvasElement;\n    this.update();\n  }\n\n  private minimapOffset(): { x: number; y: number } {\n    return {\n      x: (this.canvasRect.width - this.minimapSize.width) / 2,\n      y: (this.canvasRect.height - this.minimapSize.height) / 2\n    };\n  }\n\n  private updateViewpoint(): void {\n    // Update the coordinates of the viewpoint rectangle.\n    select(this.viewpoint).attr('x', this.viewpointCoord.x).attr('y', this.viewpointCoord.y);\n    // Update the translation vector of the main svg to reflect the\n    // new viewpoint.\n    const mainX = (-this.viewpointCoord.x * this.scaleMain) / this.scaleMinimap;\n    const mainY = (-this.viewpointCoord.y * this.scaleMain) / this.scaleMinimap;\n    select(this.svg).call(this.mainZoom.transform, zoomIdentity.translate(mainX, mainY).scale(this.scaleMain));\n  }\n\n  update(): void {\n    let sceneSize = null;\n    try {\n      // Get the size of the entire scene.\n      sceneSize = this.zoomG.getBBox();\n      if (sceneSize.width === 0) {\n        // There is no scene anymore. We have been detached from the dom.\n        return;\n      }\n    } catch (e) {\n      // Firefox produced NS_ERROR_FAILURE if we have been\n      // detached from the dom.\n      return;\n    }\n\n    const svgSelection = select(this.svg);\n    // Read all the style rules in the document and embed them into the svg.\n    // The svg needs to be self contained, i.e. all the style rules need to be\n    // embedded so the canvas output matches the origin.\n    let stylesText = '';\n\n    for (const k of new Array(document.styleSheets.length).keys()) {\n      try {\n        const cssRules = (document.styleSheets[k] as NzSafeAny).cssRules || (document.styleSheets[k] as NzSafeAny).rules;\n        if (cssRules == null) {\n          continue;\n        }\n        for (const i of new Array(cssRules.length).keys()) {\n          // Remove tf-* selectors from the styles.\n          stylesText += cssRules[i].cssText.replace(/ ?tf-[\\w-]+ ?/g, '') + '\\n';\n        }\n      } catch (e) {\n        if (e.name !== 'SecurityError') {\n          throw e;\n        }\n      }\n    }\n\n    // Temporarily add the css rules to the main svg.\n    const svgStyle = svgSelection.append('style');\n    svgStyle.text(stylesText);\n\n    // Temporarily remove the zoom/pan transform from the main svg since we\n    // want the minimap to show a zoomed-out and centered view.\n    const zoomGSelection = select(this.zoomG);\n    const zoomTransform = zoomGSelection.attr('transform');\n    zoomGSelection.attr('transform', null);\n\n    // Since we add padding, account for that here.\n    sceneSize.height += this.labelPadding * 2;\n    sceneSize.width += this.labelPadding * 2;\n\n    // Temporarily assign an explicit width/height to the main svg, since\n    // it doesn't have one (uses flex-box), but we need it for the canvas\n    // to work.\n    svgSelection.attr('width', sceneSize.width).attr('height', sceneSize.height);\n\n    // Since the content inside the svg changed (e.g. a node was expanded),\n    // the aspect ratio have also changed. Thus, we need to update the scale\n    // factor of the minimap. The scale factor is determined such that both\n    // the width and height of the minimap are <= maximum specified w/h.\n    this.scaleMinimap = this.maxWidth / Math.max(sceneSize.width, sceneSize.height);\n    this.minimapSize = {\n      width: sceneSize.width * this.scaleMinimap,\n      height: sceneSize.height * this.scaleMinimap\n    };\n\n    const minimapOffset = this.minimapOffset();\n\n    // Update the size of the minimap's svg, the buffer canvas and the\n    // viewpoint rect.\n    select(this.minimapSvg).attr(this.minimapSize as NzSafeAny);\n    select(this.canvasBuffer).attr(this.minimapSize as NzSafeAny);\n\n    if (this.translate != null && this.zoom != null) {\n      // Update the viewpoint rectangle shape since the aspect ratio of the\n      // map has changed.\n      requestAnimationFrame(() => this.zoom());\n    }\n\n    // Serialize the main svg to a string which will be used as the rendering\n    // content for the canvas.\n    const svgXml = new XMLSerializer().serializeToString(this.svg);\n\n    // Now that the svg is serialized for rendering, remove the temporarily\n    // assigned styles, explicit width and height and bring back the pan/zoom\n    // transform.\n    svgStyle.remove();\n    svgSelection.attr('width', '100%').attr('height', '100%');\n\n    zoomGSelection.attr('transform', zoomTransform);\n\n    const image = document.createElement('img');\n    image.onload = () => {\n      // Draw the svg content onto the buffer canvas.\n      const context = this.canvasBuffer.getContext('2d');\n      context!.clearRect(0, 0, this.canvasBuffer.width, this.canvasBuffer.height);\n\n      context!.drawImage(image, minimapOffset.x, minimapOffset.y, this.minimapSize.width, this.minimapSize.height);\n      requestAnimationFrame(() => {\n        // Hide the old canvas and show the new buffer canvas.\n        select(this.canvasBuffer).style('display', 'block');\n        select(this.canvas).style('display', 'none');\n        // Swap the two canvases.\n        [this.canvas, this.canvasBuffer] = [this.canvasBuffer, this.canvas];\n      });\n    };\n    image.src = 'data:image/svg+xml;charset=utf-8,' + encodeURIComponent(svgXml);\n  }\n\n  /**\n   * Handles changes in zooming/panning. Should be called from the main svg\n   * to notify that a zoom/pan was performed and this minimap will update it's\n   * viewpoint rectangle.\n   * @param transform\n   */\n  zoom(transform?: ZoomTransform | NzZoomTransform): void {\n    if (this.scaleMinimap == null) {\n      // Scene is not ready yet.\n      return;\n    }\n    // Update the new translate and scale params, only if specified.\n    if (transform) {\n      this.translate = [transform.x, transform.y];\n      this.scaleMain = transform.k;\n    }\n\n    // Update the location of the viewpoint rectangle.\n    const svgRect = this.svg.getBoundingClientRect();\n    const minimapOffset = this.minimapOffset();\n    const viewpointSelection = select(this.viewpoint);\n    this.viewpointCoord.x = (-this.translate[0] * this.scaleMinimap) / this.scaleMain;\n    this.viewpointCoord.y = (-this.translate[1] * this.scaleMinimap) / this.scaleMain;\n    const viewpointWidth = (svgRect.width * this.scaleMinimap) / this.scaleMain;\n    const viewpointHeight = (svgRect.height * this.scaleMinimap) / this.scaleMain;\n    viewpointSelection\n      .attr('x', this.viewpointCoord.x + minimapOffset.x)\n      .attr('y', this.viewpointCoord.y + minimapOffset.y)\n      .attr('width', viewpointWidth)\n      .attr('height', viewpointHeight);\n    // Show/hide the minimap depending on the viewpoint area as fraction of the\n    // whole minimap.\n    const mapWidth = this.minimapSize.width;\n    const mapHeight = this.minimapSize.height;\n    const x = this.viewpointCoord.x;\n    const y = this.viewpointCoord.y;\n    const w = Math.min(Math.max(0, x + viewpointWidth), mapWidth) - Math.min(Math.max(0, x), mapWidth);\n    const h = Math.min(Math.max(0, y + viewpointHeight), mapHeight) - Math.min(Math.max(0, y), mapHeight);\n    const fracIntersect = (w * h) / (mapWidth * mapHeight);\n    if (fracIntersect < FRAC_VIEWPOINT_AREA) {\n      this.minimap.classList.remove('hidden');\n    } else {\n      this.minimap.classList.add('hidden');\n    }\n  }\n}\n","/**\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://github.com/NG-ZORRO/ng-zorro-antd/blob/master/LICENSE\n */\n\nimport { ChangeDetectionStrategy, Component, ElementRef, OnInit } from '@angular/core';\nimport { ZoomBehavior } from 'd3-zoom';\nimport { NzSafeAny } from 'ng-zorro-antd/core/types';\nimport { Minimap } from './core/minimap';\nimport { NzZoomTransform } from './interface';\n\n@Component({\n  selector: 'nz-graph-minimap',\n  template: `\n    <svg>\n      <defs>\n        <filter id=\"minimapDropShadow\" x=\"-20%\" y=\"-20%\" width=\"150%\" height=\"150%\">\n          <feOffset result=\"offOut\" in=\"SourceGraphic\" dx=\"1\" dy=\"1\"></feOffset>\n          <feColorMatrix\n            result=\"matrixOut\"\n            in=\"offOut\"\n            type=\"matrix\"\n            values=\"0.1 0 0 0 0 0 0.1 0 0 0 0 0 0.1 0 0 0 0 0 0.5 0\"\n          ></feColorMatrix>\n          <feGaussianBlur result=\"blurOut\" in=\"matrixOut\" stdDeviation=\"2\"></feGaussianBlur>\n          <feBlend in=\"SourceGraphic\" in2=\"blurOut\" mode=\"normal\"></feBlend>\n        </filter>\n      </defs>\n      <rect></rect>\n    </svg>\n    <canvas class=\"viewport\"></canvas>\n    <!-- Additional canvas to use as buffer to avoid flickering between updates -->\n    <canvas class=\"buffer\"></canvas>\n  `,\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  host: {\n    '[class.nz-graph-minimap]': 'true'\n  }\n})\nexport class NzGraphMinimapComponent implements OnInit {\n  minimap?: Minimap;\n  constructor(private elementRef: ElementRef<HTMLElement>) {}\n\n  ngOnInit(): void {}\n\n  init(containerEle: ElementRef, zoomBehavior: ZoomBehavior<NzSafeAny, NzSafeAny>): void {\n    const svgEle = containerEle.nativeElement.querySelector('svg');\n    const zoomEle = containerEle.nativeElement.querySelector('svg > g');\n    this.minimap = new Minimap(svgEle, zoomEle, zoomBehavior, this.elementRef.nativeElement, 150, 0);\n  }\n\n  zoom(transform: NzZoomTransform): void {\n    if (this.minimap) {\n      this.minimap.zoom(transform);\n    }\n  }\n\n  update(): void {\n    if (this.minimap) {\n      this.minimap.update();\n    }\n  }\n}\n","/**\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://github.com/NG-ZORRO/ng-zorro-antd/blob/master/LICENSE\n */\n\nimport { animate, AnimationBuilder, AnimationFactory, AnimationPlayer, group, query, style } from '@angular/animations';\nimport { ChangeDetectionStrategy, Component, ElementRef, EventEmitter, Input, Output, Renderer2, TemplateRef } from '@angular/core';\nimport { InputBoolean } from 'ng-zorro-antd/core/util';\nimport { Observable, Subject } from 'rxjs';\nimport { NzGraphGroupNode, NzGraphNode } from './interface';\n\ninterface Info {\n  x: number;\n  y: number;\n  width: number;\n  height: number;\n}\n@Component({\n  selector: '[nz-graph-node]',\n  template: `\n    <svg:g>\n      <ng-container\n        *ngIf=\"customTemplate\"\n        [ngTemplateOutlet]=\"customTemplate\"\n        [ngTemplateOutletContext]=\"{ $implicit: node }\"\n      ></ng-container>\n      <ng-container *ngIf=\"!customTemplate\">\n        <svg:rect class=\"nz-graph-node-rect\" [attr.width]=\"node.width\" [attr.height]=\"node.height\"></svg:rect>\n        <svg:text x=\"10\" y=\"20\">{{ node.id || node.name }}</svg:text>\n      </ng-container>\n    </svg:g>\n  `,\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  host: {\n    '[id]': 'node.id || node.name',\n    '[class.nz-graph-node-expanded]': 'node.expanded',\n    '[class.nz-graph-group-node]': 'node.type===0',\n    '[class.nz-graph-base-node]': 'node.type===1',\n    '(click)': 'triggerClick($event)'\n  }\n})\nexport class NzGraphNodeComponent {\n  @Input() node!: NzGraphNode | NzGraphGroupNode;\n  @Input() @InputBoolean() noAnimation?: boolean;\n  @Input() customTemplate?: TemplateRef<{\n    $implicit: NzGraphNode | NzGraphGroupNode;\n  }>;\n\n  @Output() readonly nodeClick: EventEmitter<NzGraphNode | NzGraphGroupNode> = new EventEmitter();\n\n  triggerClick(event: MouseEvent): void {\n    event.preventDefault();\n    this.nodeClick.emit(this.node);\n  }\n\n  animationInfo: Info | null = null;\n  initialState = true;\n\n  private animationPlayer: AnimationPlayer | null = null;\n\n  constructor(private el: ElementRef, private builder: AnimationBuilder, private renderer2: Renderer2) {}\n\n  makeAnimation(): Observable<void> {\n    const cur = this.getAnimationInfo();\n    if (this.animationPlayer) {\n      this.animationPlayer.destroy();\n    }\n    let animationFactory: AnimationFactory;\n    const pre = { ...this.animationInfo } as Info;\n\n    if (this.initialState) {\n      animationFactory = this.builder.build([\n        style({ transform: `translate(${cur.x}px, ${cur.y}px)` }),\n        query('g', [\n          style({\n            width: `${cur.width}px`,\n            height: `${cur.height}px`\n          })\n        ])\n      ]);\n      this.initialState = false;\n    } else {\n      animationFactory = this.builder.build([\n        style({ transform: `translate(${pre!.x}px, ${pre!.y}px)` }),\n        query('g', [\n          style({\n            width: `${pre!.width}px`,\n            height: `${pre!.height}px`\n          })\n        ]),\n        group([\n          query('g', [\n            animate(\n              '150ms ease-out',\n              style({\n                width: `${cur.width}px`,\n                height: `${cur.height}px`\n              })\n            )\n          ]),\n          animate('150ms ease-out', style({ transform: `translate(${cur.x}px, ${cur.y}px)` }))\n        ])\n      ]);\n    }\n    this.animationInfo = cur;\n    this.animationPlayer = animationFactory.create(this.el.nativeElement);\n    this.animationPlayer.play();\n    const done$ = new Subject<void>();\n    this.animationPlayer.onDone(() => {\n      // Need this for canvas for now.\n      this.renderer2.setAttribute(this.el.nativeElement, 'transform', `translate(${cur.x}, ${cur.y})`);\n      done$.next();\n      done$.complete();\n    });\n    return done$.asObservable();\n  }\n\n  makeNoAnimation(): void {\n    const cur = this.getAnimationInfo();\n    // Need this for canvas for now.\n    this.renderer2.setAttribute(this.el.nativeElement, 'transform', `translate(${cur.x}, ${cur.y})`);\n  }\n\n  getAnimationInfo(): Info {\n    const { x, y } = this.nodeTransform();\n    return {\n      width: this.node.width,\n      height: this.node.height,\n      x,\n      y\n    };\n  }\n\n  nodeTransform(): { x: number; y: number } {\n    const x = this.computeCXPositionOfNodeShape() - this.node.width / 2;\n    const y = this.node.y - this.node.height / 2;\n    return { x, y };\n  }\n\n  computeCXPositionOfNodeShape(): number {\n    if ((this.node as NzGraphGroupNode).expanded) {\n      return this.node.x;\n    }\n    return this.node.x - this.node.width / 2 + this.node.coreBox.width / 2;\n  }\n}\n","/**\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://github.com/NG-ZORRO/ng-zorro-antd/blob/master/LICENSE\n */\n\nimport { Directive } from '@angular/core';\n\n@Directive({\n  selector: '[nzGraphNode]',\n  exportAs: 'nzGraphNode'\n})\nexport class NzGraphNodeDirective {}\n","/**\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://github.com/NG-ZORRO/ng-zorro-antd/blob/master/LICENSE\n */\n\nimport { NzZoomTransform } from '../interface';\n\n/**\n * Calculate position and scale\n * @param containerEle\n * @param targetEle\n * @param scale: if scale is set, skip calculate scale value\n */\nexport const calculateTransform = (containerEle: SVGSVGElement, targetEle: SVGGElement, scale?: number): NzZoomTransform | null => {\n  const containerEleSize = containerEle.getBoundingClientRect();\n  const targetEleSize = targetEle.getBBox();\n  if (!targetEleSize.width) {\n    // There is no g element anymore.\n    return null;\n  }\n\n  // TODO\n  // leave some place when re-scale\n  const scaleUnit = (containerEleSize.width - 48) / containerEleSize.width;\n  const k = scale || Math.min(containerEleSize.width / targetEleSize.width, containerEleSize.height / targetEleSize.height, 1) * scaleUnit;\n  const x = (containerEleSize.width - targetEleSize.width * k) / 2;\n  const y = (containerEleSize.height - targetEleSize.height * k) / 2;\n  return {\n    x,\n    y,\n    k\n  };\n};\n","/**\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://github.com/NG-ZORRO/ng-zorro-antd/blob/master/LICENSE\n */\n\nimport { AfterViewInit, ChangeDetectorRef, Directive, ElementRef, EventEmitter, Input, OnDestroy, Output } from '@angular/core';\nimport { select, Selection } from 'd3-selection';\nimport { transition as d3Transition } from 'd3-transition';\nimport { zoom, ZoomBehavior, zoomIdentity, zoomTransform } from 'd3-zoom';\nimport { NzSafeAny } from 'ng-zorro-antd/core/types';\nimport { Subject } from 'rxjs';\nimport { calculateTransform } from './core/utils';\nimport { NzZoomTransform, RelativePositionInfo } from './interface';\nSelection.bind('transition', d3Transition);\n\n@Directive({\n  selector: '[nz-graph-zoom]',\n  exportAs: 'nzGraphZoom'\n})\nexport class NzGraphZoomDirective implements OnDestroy, AfterViewInit {\n  @Input() nzZoom?: number;\n  @Input() nzMinZoom = 0.1;\n  @Input() nzMaxZoom = 10;\n\n  @Output() readonly nzTransformEvent: EventEmitter<NzZoomTransform> = new EventEmitter();\n  @Output() readonly nzZoomChange: EventEmitter<number> = new EventEmitter();\n\n  svgSelection!: Selection<NzSafeAny, NzSafeAny, NzSafeAny, NzSafeAny>;\n  zoomBehavior!: ZoomBehavior<NzSafeAny, NzSafeAny>;\n\n  // TODO\n  // Support svg element only now\n  svgElement!: SVGSVGElement;\n  gZoomElement!: SVGGElement;\n\n  private destroy$ = new Subject<void>();\n\n  constructor(private element: ElementRef, private cdr: ChangeDetectorRef) {}\n\n  ngAfterViewInit(): void {\n    this.bind();\n  }\n\n  ngOnDestroy(): void {\n    this.unbind();\n    this.destroy$.next();\n    this.destroy$.complete();\n  }\n\n  bind(): void {\n    this.svgElement = this.element.nativeElement.querySelector('svg') as SVGSVGElement;\n    this.gZoomElement = this.element.nativeElement.querySelector('svg > g') as SVGGElement;\n    const { width, height } = this.element.nativeElement.getBoundingClientRect();\n    this.svgSelection = select(this.svgElement);\n    this.zoomBehavior = zoom()\n      .extent([\n        [0, 0],\n        [width, height]\n      ])\n      .scaleExtent([this.nzMinZoom, this.nzMaxZoom])\n      .on('zoom', e => {\n        this.zoomed(e);\n      });\n    this.svgSelection.call(this.zoomBehavior, zoomIdentity.translate(0, 0).scale(this.nzZoom || 1));\n    // Init with nzZoom\n    this.reScale(0, this.nzZoom);\n  }\n\n  unbind(): void {\n    // Destroy listener\n    this.svgSelection?.interrupt().selectAll('*').interrupt();\n    if (this.zoomBehavior) {\n      this.zoomBehavior.on('end', null).on('zoom', null);\n    }\n  }\n\n  // Methods\n  fitCenter(duration: number = 0): void {\n    this.reScale(duration);\n  }\n\n  focus(id: NzSafeAny, duration: number = 0): void {\n    // Make sure this node is under SVG container\n    if (!this.svgElement.getElementById(`${id}`)) {\n      return;\n    }\n\n    const node = this.svgElement.getElementById(`${id}`) as SVGGElement;\n    const svgRect = this.svgElement.getBoundingClientRect();\n    const position = this.getRelativePositionInfo(node);\n    const svgTransform = zoomTransform(this.svgElement);\n\n    const centerX = (position.topLeft.x + position.bottomRight.x) / 2;\n    const centerY = (position.topLeft.y + position.bottomRight.y) / 2;\n    const dx = svgRect.left + svgRect.width / 2 - centerX;\n    const dy = svgRect.top + svgRect.height / 2 - centerY;\n\n    this.svgSelection\n      .transition()\n      .duration(duration)\n      .call(this.zoomBehavior.translateBy, dx / svgTransform.k, dy / svgTransform.k);\n  }\n\n  /**\n   * Handle zoom event\n   * @param transform\n   */\n  private zoomed({ transform }: NzSafeAny): void {\n    const { x, y, k } = transform;\n    // Update g element transform\n    (this.gZoomElement as SVGGElement).setAttribute('transform', `translate(${x}, ${y})scale(${k})`);\n    this.nzZoom = k;\n    this.nzZoomChange.emit(this.nzZoom);\n    this.nzTransformEvent.emit(transform);\n    this.cdr.markForCheck();\n  }\n\n  /**\n   * Scale with zoom and duration\n   * @param duration\n   * @param scale\n   * @private\n   */\n  private reScale(duration: number, scale?: number): void {\n    const transform = calculateTransform(this.svgElement, this.gZoomElement, scale);\n    if (!transform) {\n      return;\n    }\n    const { x, y, k } = transform;\n    const zTransform = zoomIdentity.translate(x, y).scale(Math.max(k, this.nzMinZoom));\n    this.svgSelection\n      .transition()\n      .duration(duration)\n      .call(this.zoomBehavior.transform, zTransform)\n      .on('end.fitted', () => {\n        this.zoomBehavior.on('end.fitted', null);\n      });\n  }\n\n  private getRelativePositionInfo(node: SVGGElement): RelativePositionInfo {\n    const nodeBox = node.getBBox();\n    const nodeCtm = node.getScreenCTM();\n    let pointTL = this.svgElement.createSVGPoint();\n    let pointBR = this.svgElement.createSVGPoint();\n\n    pointTL.x = nodeBox.x;\n    pointTL.y = nodeBox.y;\n    pointBR.x = nodeBox.x + nodeBox.width;\n    pointBR.y = nodeBox.y + nodeBox.height;\n    pointTL = pointTL.matrixTransform(nodeCtm!);\n    pointBR = pointBR.matrixTransform(nodeCtm!);\n    return {\n      topLeft: pointTL,\n      bottomRight: pointBR\n    };\n  }\n}\n","/**\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://github.com/NG-ZORRO/ng-zorro-antd/blob/master/LICENSE\n */\n\nimport {\n  AfterContentChecked,\n  AfterViewInit,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  ContentChild,\n  ElementRef,\n  EventEmitter,\n  Host,\n  Input,\n  OnChanges,\n  OnDestroy,\n  OnInit,\n  Optional,\n  Output,\n  QueryList,\n  SimpleChanges,\n  TemplateRef,\n  ViewChildren,\n  ViewEncapsulation\n} from '@angular/core';\n\nimport { buildGraph } from 'dagre-compound';\n\nimport { forkJoin, Observable, ReplaySubject, Subject, Subscription } from 'rxjs';\nimport { finalize, take, takeUntil } from 'rxjs/operators';\nimport { calculateTransform } from './core/utils';\n\nimport { NzNoAnimationDirective } from 'ng-zorro-antd/core/no-animation';\nimport { cancelRequestAnimationFrame } from 'ng-zorro-antd/core/polyfill';\nimport { BooleanInput, NzSafeAny } from 'ng-zorro-antd/core/types';\nimport { InputBoolean } from 'ng-zorro-antd/core/util';\n\nimport { NzGraphData } from './data-source/graph-data-source';\nimport { NzGraphEdgeDirective } from './graph-edge.directive';\nimport { NzGraphGroupNodeDirective } from './graph-group-node.directive';\nimport { NzGraphNodeComponent } from './graph-node.component';\nimport { NzGraphNodeDirective } from './graph-node.directive';\nimport { NzGraphZoomDirective } from './graph-zoom.directive';\nimport {\n  NzGraphDataDef,\n  NzGraphEdge,\n  NzGraphEdgeDef,\n  NzGraphGroupNode,\n  NzGraphLayoutConfig,\n  NzGraphNode,\n  NzGraphNodeDef,\n  NzGraphOption,\n  NzLayoutSetting,\n  NzRankDirection,\n  nzTypeDefinition,\n  NZ_GRAPH_LAYOUT_SETTING\n} from './interface';\n\n/** Checks whether an object is a data source. */\nexport function isDataSource(value: NzSafeAny): value is NzGraphData {\n  // Check if the value is a DataSource by observing if it has a connect function. Cannot\n  // be checked as an `instanceof DataSource` since people could create their own sources\n  // that match the interface, but don't extend DataSource.\n  return value && typeof value.connect === 'function';\n}\n\n@Component({\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  encapsulation: ViewEncapsulation.None,\n  selector: 'nz-graph',\n  exportAs: 'nzGraph',\n  template: `\n    <ng-content></ng-content>\n    <svg width=\"100%\" height=\"100%\">\n      <svg:defs nz-graph-defs></svg:defs>\n      <svg:g [attr.transform]=\"transformStyle\">\n        <ng-container\n          [ngTemplateOutlet]=\"groupTemplate\"\n          [ngTemplateOutletContext]=\"{ renderNode: renderInfo, type: 'root' }\"\n        ></ng-container>\n      </svg:g>\n    </svg>\n\n    <ng-template #groupTemplate let-renderNode=\"renderNode\" let-type=\"type\">\n      <svg:g [attr.transform]=\"type === 'sub' ? subGraphTransform(renderNode) : null\">\n        <svg:g class=\"core\" [attr.transform]=\"coreTransform(renderNode)\">\n          <svg:g class=\"nz-graph-edges\">\n            <ng-container *ngFor=\"let edge of renderNode.edges; trackBy: edgeTrackByFun\">\n              <g\n                class=\"nz-graph-edge\"\n                nz-graph-edge\n                [edge]=\"edge\"\n                [edgeType]=\"nzGraphLayoutConfig?.defaultEdge?.type\"\n                [customTemplate]=\"customGraphEdgeTemplate\"\n              ></g>\n            </ng-container>\n          </svg:g>\n\n          <svg:g class=\"nz-graph-nodes\">\n            <ng-container *ngFor=\"let node of typedNodes(renderNode.nodes); trackBy: nodeTrackByFun\">\n              <g\n                *ngIf=\"node.type === 1\"\n                class=\"nz-graph-node\"\n                nz-graph-node\n                [node]=\"node\"\n                [customTemplate]=\"nodeTemplate\"\n                (nodeClick)=\"clickNode($event)\"\n              ></g>\n              <g\n                *ngIf=\"node.type === 0\"\n                class=\"nz-graph-node\"\n                nz-graph-node\n                [node]=\"node\"\n                [customTemplate]=\"groupNodeTemplate\"\n                (nodeClick)=\"clickNode($event)\"\n              ></g>\n              <ng-container\n                *ngIf=\"node.expanded\"\n                [ngTemplateOutlet]=\"groupTemplate\"\n                [ngTemplateOutletContext]=\"{ renderNode: node, type: 'sub' }\"\n              ></ng-container>\n            </ng-container>\n          </svg:g>\n        </svg:g>\n      </svg:g>\n    </ng-template>\n  `,\n  host: {\n    '[class.nz-graph]': 'true',\n    '[class.nz-graph-auto-size]': 'nzAutoSize'\n  }\n})\nexport class NzGraphComponent implements OnInit, OnChanges, AfterViewInit, AfterContentChecked, OnDestroy {\n  static ngAcceptInputType_nzAutoSize: BooleanInput;\n\n  @ViewChildren(NzGraphNodeComponent, { read: ElementRef }) listOfNodeElement!: QueryList<ElementRef>;\n  @ViewChildren(NzGraphNodeComponent) listOfNodeComponent!: QueryList<NzGraphNodeComponent>;\n\n  @ContentChild(NzGraphNodeDirective, { static: true, read: TemplateRef }) nodeTemplate?: TemplateRef<{\n    $implicit: NzGraphNode;\n  }>;\n  @ContentChild(NzGraphGroupNodeDirective, { static: true, read: TemplateRef }) groupNodeTemplate?: TemplateRef<{\n    $implicit: NzGraphGroupNode;\n  }>;\n  @ContentChild(NzGraphEdgeDirective, { static: true, read: TemplateRef }) customGraphEdgeTemplate?: TemplateRef<{\n    $implicit: NzGraphEdge;\n  }>;\n  /**\n   * Provides a stream containing the latest data array to render.\n   * Data source can be an observable of NzGraphData, or a NzGraphData to render.\n   */\n  @Input() nzGraphData!: NzGraphData;\n  @Input() nzRankDirection: NzRankDirection = 'LR';\n  @Input() nzGraphLayoutConfig?: NzGraphLayoutConfig;\n  @Input() @InputBoolean() nzAutoSize = false;\n\n  @Output() readonly nzGraphInitialized = new EventEmitter<NzGraphComponent>();\n  @Output() readonly nzGraphRendered = new EventEmitter<NzGraphComponent>();\n  @Output() readonly nzNodeClick: EventEmitter<NzGraphNode | NzGraphGroupNode> = new EventEmitter();\n\n  requestId: number = -1;\n  transformStyle = '';\n  graphRenderedSubject$ = new ReplaySubject<void>(1);\n  renderInfo: NzGraphGroupNode = { labelHeight: 0 } as NzGraphGroupNode;\n  mapOfNodeAttr: { [key: string]: NzGraphNodeDef } = {};\n  mapOfEdgeAttr: { [key: string]: NzGraphEdgeDef } = {};\n  zoom = 1;\n\n  public readonly typedNodes = nzTypeDefinition<Array<NzGraphNode | NzGraphGroupNode>>();\n  private dataSource?: NzGraphData;\n  private layoutSetting: NzLayoutSetting = NZ_GRAPH_LAYOUT_SETTING;\n  /** Data subscription */\n  private _dataSubscription?: Subscription | null;\n  private destroy$ = new Subject<void>();\n\n  nodeTrackByFun = (_: number, node: NzGraphNode | NzGraphGroupNode) => node.name;\n  edgeTrackByFun = (_: number, edge: NzGraphEdge) => `${edge.v}-${edge.w}`;\n\n  subGraphTransform = (node: NzGraphGroupNode) => {\n    const x = node.x - node.coreBox.width / 2.0;\n    const y = node.y - node.height / 2.0 + node.paddingTop;\n    return `translate(${x}, ${y})`;\n  };\n\n  coreTransform = (node: NzGraphGroupNode) => {\n    return `translate(0, ${node.parentNodeName ? node.labelHeight : 0})`;\n  };\n\n  constructor(\n    private cdr: ChangeDetectorRef,\n    private elementRef: ElementRef,\n    @Host() @Optional() public noAnimation?: NzNoAnimationDirective,\n    @Optional() public nzGraphZoom?: NzGraphZoomDirective\n  ) {}\n\n  ngOnInit(): void {\n    this.graphRenderedSubject$.pipe(take(1), takeUntil(this.destroy$)).subscribe(() => {\n      // Only zooming is not set, move graph to center\n      if (!this.nzGraphZoom) {\n        this.fitCenter();\n      }\n      this.nzGraphInitialized.emit(this);\n    });\n  }\n\n  ngOnChanges(changes: SimpleChanges): void {\n    const { nzAutoFit, nzRankDirection, nzGraphData, nzGraphLayoutConfig } = changes;\n    if (nzGraphLayoutConfig) {\n      this.layoutSetting = this.mergeConfig(nzGraphLayoutConfig.currentValue);\n    }\n\n    if (nzGraphData) {\n      if (this.dataSource !== this.nzGraphData) {\n        this._switchDataSource(this.nzGraphData);\n      }\n    }\n\n    if ((nzAutoFit && !nzAutoFit.firstChange) || (nzRankDirection && !nzRankDirection.firstChange)) {\n      // Render graph\n      if (this.dataSource!.dataSource) {\n        this.drawGraph(this.dataSource!.dataSource, {\n          rankDirection: this.nzRankDirection,\n          expanded: this.dataSource!.expansionModel.selected || []\n        }).then(() => {\n          this.cdr.markForCheck();\n        });\n      }\n    }\n\n    this.cdr.markForCheck();\n  }\n\n  ngAfterViewInit(): void {}\n\n  ngAfterContentChecked(): void {\n    if (this.dataSource && !this._dataSubscription) {\n      this.observeRenderChanges();\n    }\n  }\n\n  ngOnDestroy(): void {\n    this.destroy$.next();\n    this.destroy$.complete();\n\n    if (this.dataSource && typeof this.dataSource.disconnect === 'function') {\n      this.dataSource.disconnect();\n    }\n\n    if (this._dataSubscription) {\n      this._dataSubscription.unsubscribe();\n      this._dataSubscription = null;\n    }\n    cancelRequestAnimationFrame(this.requestId);\n  }\n\n  /**\n   * Emit event\n   */\n  clickNode(node: NzGraphNode | NzGraphGroupNode): void {\n    this.nzNodeClick.emit(node);\n  }\n\n  /**\n   * Move graph to center and scale automatically\n   */\n  fitCenter(): void {\n    const { x, y, k } = calculateTransform(\n      this.elementRef.nativeElement.querySelector('svg'),\n      this.elementRef.nativeElement.querySelector('svg > g')\n    )!;\n    if (k) {\n      this.zoom = k;\n      this.transformStyle = `translate(${x}, ${y})scale(${k})`;\n    }\n    this.cdr.markForCheck();\n  }\n\n  /**\n   * re-Draw graph\n   * @param data\n   * @param options\n   * @param needResize\n   */\n  drawGraph(data: NzGraphDataDef, options: NzGraphOption, needResize: boolean = false): Promise<void> {\n    return new Promise(resolve => {\n      this.requestId = requestAnimationFrame(() => {\n        const renderInfo = this.buildGraphInfo(data, options);\n        // TODO\n        // Need better performance\n        this.renderInfo = renderInfo;\n        this.cdr.markForCheck();\n        this.requestId = requestAnimationFrame(() => {\n          this.drawNodes(!this.noAnimation?.nzNoAnimation).then(() => {\n            // Update element\n            this.cdr.markForCheck();\n            if (needResize) {\n              this.resizeNodeSize().then(() => {\n                const dataSource: NzGraphDataDef = this.dataSource!.dataSource!;\n                this.drawGraph(dataSource, options, false).then(() => resolve());\n              });\n            } else {\n              this.graphRenderedSubject$.next();\n              this.nzGraphRendered.emit(this);\n              resolve();\n            }\n          });\n        });\n      });\n      this.cdr.markForCheck();\n    });\n  }\n\n  /**\n   * Redraw all nodes\n   * @param animate\n   */\n  drawNodes(animate: boolean = true): Promise<void> {\n    return new Promise(resolve => {\n      if (animate) {\n        this.makeNodesAnimation().subscribe(() => {\n          resolve();\n        });\n      } else {\n        this.listOfNodeComponent.map(node => {\n          node.makeNoAnimation();\n        });\n        resolve();\n      }\n    });\n  }\n\n  private resizeNodeSize(): Promise<void> {\n    return new Promise(resolve => {\n      const dataSource: NzGraphDataDef = this.dataSource!.dataSource!;\n      let scale = this.nzGraphZoom?.nzZoom || this.zoom || 1;\n      this.listOfNodeElement.forEach(nodeEle => {\n        const contentEle = nodeEle.nativeElement;\n        if (contentEle) {\n          let width: number;\n          let height: number;\n          // Check if foreignObject is set\n          const clientRect = contentEle.querySelector('foreignObject > :first-child')?.getBoundingClientRect();\n          if (clientRect) {\n            width = clientRect.width;\n            height = clientRect.height;\n          } else {\n            const bBoxRect = contentEle.getBBox();\n            width = bBoxRect.width;\n            height = bBoxRect.height;\n            // getBBox will return actual value\n            scale = 1;\n          }\n          // Element id type is string\n          const node = dataSource.nodes.find(n => `${n.id}` === nodeEle.nativeElement.id);\n          if (node && width && height) {\n            node.height = height / scale;\n            node.width = width / scale;\n          }\n        }\n      });\n      resolve();\n    });\n  }\n\n  /**\n   * Switch to the provided data source by resetting the data and unsubscribing from the current\n   * render change subscription if one exists. If the data source is null, interpret this by\n   * clearing the node outlet. Otherwise start listening for new data.\n   */\n  private _switchDataSource(dataSource: NzGraphData): void {\n    if (this.dataSource && typeof this.dataSource.disconnect === 'function') {\n      this.nzGraphData.disconnect();\n    }\n\n    if (this._dataSubscription) {\n      this._dataSubscription.unsubscribe();\n      this._dataSubscription = null;\n    }\n\n    this.dataSource = dataSource;\n    this.observeRenderChanges();\n  }\n\n  /** Set up a subscription for the data provided by the data source. */\n  private observeRenderChanges(): void {\n    let dataStream: Observable<NzGraphDataDef> | undefined;\n    let graphOptions: NzGraphOption = {\n      rankDirection: this.nzRankDirection\n    };\n    if (isDataSource(this.dataSource)) {\n      dataStream = this.dataSource.connect();\n    }\n\n    if (dataStream) {\n      this._dataSubscription = dataStream.pipe(takeUntil(this.destroy$)).subscribe(data => {\n        graphOptions = {\n          rankDirection: this.nzRankDirection,\n          expanded: this.nzGraphData.expansionModel.selected\n        };\n        this.drawGraph(data, graphOptions, this.nzAutoSize).then(() => {\n          this.cdr.detectChanges();\n        });\n      });\n    } else {\n      throw Error(`A valid data source must be provided.`);\n    }\n  }\n\n  /**\n   * Get renderInfo and prepare some data\n   * @param data\n   * @param options\n   * @private\n   */\n  private buildGraphInfo(data: NzGraphDataDef, options: NzGraphOption): NzGraphGroupNode {\n    this.parseInfo(data);\n    const renderInfo = buildGraph(data, options, this.layoutSetting) as NzGraphGroupNode;\n    const dig = (nodes: Array<NzGraphNode | NzGraphGroupNode>): void => {\n      nodes.forEach(node => {\n        const { x, y } = node;\n        node.xOffset = x;\n        node.yOffset = y;\n        if (node.type === 1 && this.mapOfNodeAttr.hasOwnProperty(node.name)) {\n          Object.assign(node, this.mapOfNodeAttr[node.name]);\n        } else if (node.type === 0) {\n          (node as NzGraphGroupNode).edges.forEach(edge => {\n            if (this.mapOfEdgeAttr.hasOwnProperty(`${edge.v}-${edge.w}`)) {\n              Object.assign(edge, this.mapOfEdgeAttr[`${edge.v}-${edge.w}`]);\n            }\n          });\n          dig(node.nodes);\n        }\n      });\n    };\n    dig(renderInfo.nodes);\n    // Assign data to edges of root graph\n    renderInfo.edges.forEach(edge => {\n      if (this.mapOfEdgeAttr.hasOwnProperty(`${edge.v}-${edge.w}`)) {\n        Object.assign(edge, this.mapOfEdgeAttr[`${edge.v}-${edge.w}`]);\n      }\n    });\n    return renderInfo;\n  }\n\n  /**\n   * Play with animation\n   * @private\n   */\n  private makeNodesAnimation(): Observable<void> {\n    return forkJoin(...this.listOfNodeComponent.map(node => node.makeAnimation())).pipe(\n      finalize(() => {\n        this.cdr.detectChanges();\n      })\n    );\n  }\n\n  private parseInfo(data: NzGraphDataDef): void {\n    data.nodes.forEach(n => {\n      this.mapOfNodeAttr[n.id] = n;\n    });\n    data.edges.forEach(e => {\n      this.mapOfEdgeAttr[`${e.v}-${e.w}`] = e;\n    });\n  }\n\n  /**\n   * Merge config with user inputs\n   * @param config\n   * @private\n   */\n  private mergeConfig(config: NzGraphLayoutConfig): NzLayoutSetting {\n    const graphMeta = config?.layout || {};\n    const subSceneMeta = config?.subScene || {};\n    const defaultNodeMeta = config?.defaultNode || {};\n    const defaultCompoundNodeMeta = config?.defaultCompoundNode || {};\n    const bridge = NZ_GRAPH_LAYOUT_SETTING.nodeSize.bridge;\n\n    const graph: NzLayoutSetting['graph'] = { meta: { ...NZ_GRAPH_LAYOUT_SETTING.graph.meta, ...graphMeta } };\n    const subScene: NzLayoutSetting['subScene'] = {\n      meta: { ...NZ_GRAPH_LAYOUT_SETTING.subScene.meta, ...subSceneMeta }\n    };\n    const nodeSize: NzLayoutSetting['nodeSize'] = {\n      meta: { ...NZ_GRAPH_LAYOUT_SETTING.nodeSize.meta, ...defaultCompoundNodeMeta },\n      node: { ...NZ_GRAPH_LAYOUT_SETTING.nodeSize.node, ...defaultNodeMeta },\n      bridge\n    };\n\n    return { graph, subScene, nodeSize };\n  }\n}\n","/**\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://github.com/NG-ZORRO/ng-zorro-antd/blob/master/LICENSE\n */\n\nimport { CommonModule } from '@angular/common';\nimport { NgModule } from '@angular/core';\nimport { NzNoAnimationModule } from 'ng-zorro-antd/core/no-animation';\nimport { NzIconModule } from 'ng-zorro-antd/icon';\nimport { NzSpinModule } from 'ng-zorro-antd/spin';\n\nimport { NzGraphDefsComponent } from './graph-defs.component';\nimport { NzGraphEdgeComponent } from './graph-edge.component';\nimport { NzGraphEdgeDirective } from './graph-edge.directive';\nimport { NzGraphGroupNodeDirective } from './graph-group-node.directive';\nimport { NzGraphMinimapComponent } from './graph-minimap.component';\nimport { NzGraphNodeComponent } from './graph-node.component';\nimport { NzGraphNodeDirective } from './graph-node.directive';\nimport { NzGraphZoomDirective } from './graph-zoom.directive';\nimport { NzGraphComponent } from './graph.component';\n\nconst COMPONENTS = [\n  NzGraphComponent,\n  NzGraphMinimapComponent,\n  NzGraphDefsComponent,\n  NzGraphNodeDirective,\n  NzGraphGroupNodeDirective,\n  NzGraphZoomDirective,\n  NzGraphNodeComponent,\n  NzGraphEdgeComponent,\n  NzGraphEdgeDirective\n];\n\n@NgModule({\n  declarations: [...COMPONENTS],\n  imports: [CommonModule, NzIconModule, NzSpinModule, NzNoAnimationModule],\n  exports: [...COMPONENTS]\n})\nexport class NzGraphModule {}\n"],"mappings":"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"}